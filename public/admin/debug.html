<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>CMS Debug</title>
  <style>
    body { font-family: monospace; background: #000; color: #fff; padding: 20px; }
    .status { margin: 10px 0; padding: 10px; border: 1px solid #333; }
    .success { border-color: #4ade80; color: #4ade80; }
    .error { border-color: #ef4444; color: #ef4444; }
    .info { border-color: #3b82f6; color: #3b82f6; }
    pre { background: #1a1a1a; padding: 10px; overflow-x: auto; }
  </style>
</head>
<body>
  <h1>üîç Gelora CMS Debug</h1>
  
  <div id="tests">
    <div class="status info">Running diagnostics...</div>
  </div>

  <script>
    const testsDiv = document.getElementById('tests');
    
    function addStatus(message, type = 'info') {
      const div = document.createElement('div');
      div.className = `status ${type}`;
      div.textContent = message;
      testsDiv.appendChild(div);
    }
    
    function addJSON(label, data) {
      const div = document.createElement('div');
      div.className = 'status info';
      div.innerHTML = `<strong>${label}:</strong><pre>${JSON.stringify(data, null, 2)}</pre>`;
      testsDiv.appendChild(div);
    }
    
    async function runTests() {
      testsDiv.innerHTML = '<div class="status info">Starting tests...</div>';
      
      // Test 1: Check if we're on HTTPS
      addStatus(`Protocol: ${window.location.protocol}`, window.location.protocol === 'https:' ? 'success' : 'error');
      
      // Test 2: Check API endpoint
      try {
        addStatus('Testing /api/test endpoint...');
        const response = await fetch('/api/test');
        if (response.ok) {
          const data = await response.json();
          addStatus('‚úÖ API Test endpoint working', 'success');
          addJSON('API Response', data);
        } else {
          addStatus(`‚ùå API Test failed: ${response.status} ${response.statusText}`, 'error');
        }
      } catch (error) {
        addStatus(`‚ùå API Test error: ${error.message}`, 'error');
      }
      
      // Test 3: Check OAuth endpoint
      try {
        addStatus('Testing /api/oauth endpoint...');
        const response = await fetch('/api/oauth');
        addStatus(`OAuth endpoint responds: ${response.status}`, response.status === 400 ? 'success' : 'info');
        addStatus('Note: 400 is expected (no auth code provided)', 'info');
      } catch (error) {
        addStatus(`‚ùå OAuth endpoint error: ${error.message}`, 'error');
      }
      
      // Test 4: Try to load Decap CMS
      addStatus('Testing Decap CMS loading...');
      try {
        const script = document.createElement('script');
        script.src = 'https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js';
        script.onload = () => {
          addStatus('‚úÖ Decap CMS script loaded', 'success');
          addStatus(`CMS object available: ${typeof window.CMS !== 'undefined'}`, typeof window.CMS !== 'undefined' ? 'success' : 'error');
        };
        script.onerror = () => {
          addStatus('‚ùå Failed to load Decap CMS script', 'error');
        };
        document.head.appendChild(script);
      } catch (error) {
        addStatus(`‚ùå Error loading CMS: ${error.message}`, 'error');
      }
      
      // Test 5: Check config.yml
      try {
        addStatus('Testing config.yml...');
        const response = await fetch('/admin/config.yml');
        if (response.ok) {
          const configText = await response.text();
          addStatus('‚úÖ config.yml accessible', 'success');
          addStatus(`Config size: ${configText.length} bytes`, 'info');
        } else {
          addStatus(`‚ùå config.yml not accessible: ${response.status}`, 'error');
        }
      } catch (error) {
        addStatus(`‚ùå Config error: ${error.message}`, 'error');
      }
    }
    
    runTests();
  </script>
</body>
</html>
